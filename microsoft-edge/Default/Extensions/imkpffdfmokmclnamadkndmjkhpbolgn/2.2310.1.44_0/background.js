let helpers={};function widgetInit(){try{for(classes in importScripts("utils/Consts.js","utils/Utils.js","utils/Api.js","utils/Snitch.js","utils/Injection.js","utils/ExtensionApi.js"),helpers)helpers[classes]=helpers[classes].prototype}catch(e){trace(e,e.stack)}}extensionInit();let interval=null;async function changePageHandler(e,t){if("loading"==t.status){iconBehaviour(e),helpers.Injection.injectCommunicationSystem(e),await helpers.Utils.websiteHasCashback(e)&&!await helpers.Utils.isCurrentRetailerHidden()&&await helpers.Utils.websiteCanPopupWidget(e)&&helpers.Injection.injectWidget({id:e});await chrome.tabs.get(e)}}async function iconBehaviour(e){let t=await helpers.Utils.websiteHasCashback(e),i=await helpers.Utils.websiteIsActivated(e),n=await helpers.Utils.websiteCanIconFlash(e);if(helpers.Utils.updateBadges(e),clearInterval(interval),t&&i&&chrome.action.setIcon({path:"images/icon-10.png"}),t&&!i)if(n){let e=0,t=1;interval=setInterval((function(){chrome.action.setIcon({path:"images/icon-"+e+".png"}),e+=t,10==e&&(t=-1),0==e&&(t=1)}),30)}else chrome.action.setIcon({path:"images/icon-10.png"});t||chrome.action.setIcon({path:"images/icon-grey.png"})}async function updateLocalStorage(){await helpers.Utils.getCurrentVersion()!=await chrome.runtime.getManifest().version&&(console.log("LOCAL STORAGE UPDATED"),await helpers.Utils.updateCurrentVersion(),await chrome.storage.local.clear())}async function trace(e,t=null){isDevMode()&&(t?console.log(e,t):console.log(e))}function isDevMode(){return!("update_url"in chrome.runtime.getManifest())}async function extensionInit(){widgetInit(),await updateLocalStorage(),await helpers.Utils.dailySnitch()}chrome.tabs.onActivated.addListener((async function(e,t){iconBehaviour(e.tabId)})),chrome.tabs.onUpdated.addListener(changePageHandler),chrome.action.onClicked.addListener((function(e){helpers.Injection.injectFromIcon(e)})),chrome.runtime.onInstalled.addListener((function(e){if("install"==e.reason){if(""!=WELCOME_PATH){let e=BASE_URL+"/extension/welcome";chrome.tabs.create({url:e,active:!0,index:0})}}else"update"==e.reason&&trace("Updated")}));