helpers.Utils=class Utils{async translate(){return"traduction"}async getDictionary(){let e=await chrome.storage.local.get(["dictionary"]);return(void 0===e.dictionary||Date.now()-parseInt(e.dictionary.lastUpdate)>TIME_BETWEEN_DICTIONARY_UPDATES)&&(e.dictionary=await helpers.Api.updateDictionary()),e.dictionary.data}async getExtConfig(){let e=await chrome.storage.local.get(["config"]);return(void 0===e.config||Date.now()-parseInt(e.config.lastUpdate)>TIME_BETWEEN_DICTIONARY_UPDATES)&&(e.config=await helpers.Api.updateConfig()),e.config.data}async getRetailerFromUrl(e){let t=await helpers.Api.getRetailersList();console.log("Searching retailer from url: "+e+"... in : ",t);for(let a=0;a<t.length;a++)if(null!=t[a]){if(new RegExp(t[a].pattern).test(e)&&""!=t[a].pattern&&null!=t[a].pattern)return t[a]}return null}async getRetailerById(e){let t=await helpers.Api.getRetailersList();for(let a=0;a<t.length;a++)if(null!=t[a]&&t[a].id==e)return t[a];return null}async getCurrentTab(){let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return e}async getCurrentVersion(){let e=await chrome.storage.local.get(["currentVersion"]);return void 0===e.currentVersion?await helpers.Utils.updateCurrentVersion():await e.currentVersion}async updateCurrentVersion(){let e=await chrome.runtime.getManifest().version;return await chrome.storage.local.set({currentVersion:e}),await e}async isHiddenRetailer(e){let t=await chrome.storage.local.get(["hiddenRetailers"]);return void 0!==await t.hiddenRetailers&&(void 0!==await t.hiddenRetailers[e]&&t.hiddenRetailers[e]>Date.now())}async isMinifiedRetailer(e){if(null==e)return!1;let t=await chrome.storage.local.get(["minifiedRetailers"]);return void 0!==await t.minifiedRetailers&&(void 0!==await t.minifiedRetailers[e]&&t.minifiedRetailers[e]>Date.now())}async isCurrentRetailerHidden(){let e=await helpers.Utils.getCurrentTab(),t=await helpers.Utils.getRetailerFromUrl(e.url);return await helpers.Utils.isHiddenRetailer(t.id)}async currentWebsiteHasCashback(){let e=await helpers.Api.getRetailersList(),t=await helpers.Utils.getCurrentTab();for(let a=0;a<e.length;a++)if(null!=e[a]){if(new RegExp(e[a].pattern).test(await t.url)&&""!=e[a].pattern&&null!=e[a].pattern)return!0}return!1}async websiteHasCashback(e){let t;t="number"==typeof e?await helpers.Utils.getTabById(e):e;let a=await helpers.Api.getRetailersList();for(let e=0;e<a.length;e++)if(null!=a[e]){if(new RegExp(a[e].pattern).test(await t.url)&&""!=a[e].pattern&&null!=a[e].pattern&&"1"===a[e].has_cb)return!0}return!1}async currentWebsiteIsActivated(){let e=await helpers.Utils.getCurrentTab(),t=await helpers.Utils.getRetailerFromUrl(e.url);return null!=t&&t.cashbackActivatedUntil>Date.now()}async websiteIsActivated(e){let t=await helpers.Utils.getTabById(e),a=await helpers.Utils.getRetailerFromUrl(t.url);return null!=a&&a.cashbackActivatedUntil>Date.now()}async currentWebsiteIsGoshop(){let e=await helpers.Utils.getCurrentTab();return await e.url.includes(BASE_URL+"/goshop/")||await e.url.includes(BASE_URL.split("www").join("dev")+"/goshop/")}async activateCashback(e){let t=await chrome.tabs.sendMessage(e,{action:"getGoshopRetailerId"});if(null==t.res)return;let a=await chrome.storage.local.get(["cashbackRetailersList"]);if("{}"==JSON.stringify(a))return;let i=await a.cashbackRetailersList;null!=i[t.res]&&(delete i[t.res].activatedCashbackSeen,i[t.res].cashbackActivatedUntil=Date.now()+CASHBACK_ACTIVATION_DURATION,chrome.storage.local.set({cashbackRetailersList:i}))}async activatedCashbackSeen(e){let t=await chrome.storage.local.get(["cashbackRetailersList"]);if("{}"==JSON.stringify(t))return;let a=await t.cashbackRetailersList;null!=a[e]&&(a[e].activatedCashbackSeen=Date.now()+CASHBACK_ACTIVATION_DURATION,chrome.storage.local.set({cashbackRetailersList:a}))}async activateCashbackFromRetailerId(e){if(null==await helpers.Api.getLoggedUser())return!1;let t=await chrome.storage.local.get(["cashbackRetailersList"]);if("{}"==JSON.stringify(t))return!1;let a=await t.cashbackRetailersList;return null!=a[e]&&(delete a[e].activatedCashbackSeen,a[e].cashbackActivatedUntil=Date.now()+CASHBACK_ACTIVATION_DURATION,chrome.storage.local.set({cashbackRetailersList:a}),!0)}async activateCouponCashback(e){let t=await chrome.storage.local.get(["couponCashbackActivatedList"]),a=[];void 0!==t.couponCashbackActivatedList&&(a=await t.couponCashbackActivatedList),a[e]=Date.now()+CASHBACK_ACTIVATION_DURATION,chrome.storage.local.set({couponCashbackActivatedList:a})}async isCouponCashbackActivated(e){let t=await chrome.storage.local.get(["couponCashbackActivatedList"]);if("{}"==JSON.stringify(t))return!1;let a=await t.couponCashbackActivatedList;return null!=a[e]&&a[e]>Date.now()}async activateNinjaCashback(e){let t=await chrome.storage.local.get(["cashbackRetailersList"]);if("{}"==JSON.stringify(t))return;let a=await t.cashbackRetailersList;null!=a[e]&&(a[e].cashbackActivatedUntil=Date.now()+CASHBACK_ACTIVATION_DURATION,chrome.storage.local.set({cashbackRetailersList:a}))}async updateBadges(e,t="#dc3545"){let a=await helpers.Utils.getTabById(e),i=await helpers.Utils.websiteHasCashback(e),r=await helpers.Utils.getRetailerFromUrl(a.url),s=0;i&&s++,null!=r&&(s+=parseInt(r.nb_coupons)),s>0&&(chrome.action.setBadgeText({text:s.toString(),tabId:e}),chrome.action.setBadgeBackgroundColor({color:t,tabId:e}))}async setBadge(e,t,a="#dc3545"){chrome.action.setBadgeText({text:badgeCounter.toString(),tabId:e}),chrome.action.setBadgeBackgroundColor({color:a,tabId:e})}async getTabById(e){return await chrome.tabs.get(e)}async websiteCanIconFlash(e){let t=await helpers.Utils.getTabById(e),a=await helpers.Utils.getRetailerFromUrl(t.url);return null!=a&&a.iconFlashAllowed}async websiteCanPopupWidget(e){let t=await helpers.Utils.getTabById(e),a=await helpers.Utils.getRetailerFromUrl(t.url);return null!=a&&a.iconPopupAllowed}async hideWidgetByTabId(e){let t=await helpers.Utils.getTabById(e),a=await helpers.Utils.getRetailerFromUrl(t.url);helpers.Utils.hideWidgetByRetailerId(a.id)}async hideWidgetByRetailerId(e){let t=await chrome.storage.local.get(["hiddenRetailers"]);return void 0===t.hiddenRetailers&&(t.hiddenRetailers=[]),t.hiddenRetailers[e]=Date.now()+HIDE_TIME,chrome.storage.local.set({hiddenRetailers:t.hiddenRetailers}),t.hiddenRetailers}async minifyWidgetByRetailerId(e,t){let a=await chrome.storage.local.get(["minifiedRetailers"]);return void 0===a.minifiedRetailers&&(a.minifiedRetailers=[]),a.minifiedRetailers[e]=t?Date.now()+MINIFIED_TIME:0,chrome.storage.local.set({minifiedRetailers:a.minifiedRetailers}),a.minifiedRetailers}async unhideWidgetByRetailerId(e){let t=await chrome.storage.local.get(["hiddenRetailers"]);return void 0===t.hiddenRetailers&&(t.hiddenRetailers=[]),t.hiddenRetailers[e]=0,chrome.storage.local.set({hiddenRetailers:t.hiddenRetailers}),t.hiddenRetailers}async dailySnitch(){let e=await chrome.storage.local.get(["lastDailySnitch"]);e.lastDailySnitch<Date.now()+864e5||(helpers.Api.snitchExtensionsList(),e.lastDailySnitch=Date.now(),chrome.storage.local.set({lastDailySnitch:e.lastDailySnitch}))}async getShopRecommendations(){return(await chrome.storage.local.get(["shop_recommendations"])).shop_recommendations??[]}async addShopRecommendations(e){let t,a=await helpers.Utils.getShopRecommendations();try{t=new URL(e).origin}catch(e){return{success:!1,error:"Url not valid 1"}}if(!t)return{success:!1,error:"Url not valid 2"};if(a.includes(t))return{success:!1,error:"Url already exists in localStorage"};a.push(t);let i=await helpers.Api.recommendShop(t);return chrome.storage.local.set({shop_recommendations:a}),{success:i}}url_domain(e){var t=document.createElement("a");return t.href=e,t.hostname}};