async function injectFonts(){let e=await chrome.runtime.getURL("fonts/fonts.css"),t=await fetch(e),i=await t.text(),n=document.createElement("style");n.innerHTML=i,document.querySelector("html").append(n)}async function injectAppDivAndStyle(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.createElement("div"),i=await chrome.runtime.getURL("");t.id=e+"-widget-container",t.style.setProperty("display","block","important"),t.attachShadow({mode:"open"});let n=document.createElement("style");n.innerHTML='@import url("'+i+'static/css/main.css");';let c=document.createElement("div");c.id=e+"-widget",t.shadowRoot.append(n),t.shadowRoot.append(c),document.querySelector("html").append(t)}async function closeWidget(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res;document.querySelector("#"+e+"-widget-container").remove()}async function minifyWidget(){console.log("TODO")}async function maximizeWidget(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.querySelector("#"+e+"-widget-container").shadowRoot.querySelector(".side-minified-widget-body");t?.click()}async function injectShadowPopup(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.createElement("div"),i=await chrome.runtime.getURL("widget.html"),n=await chrome.runtime.getURL(""),c=await fetch(i),a=await c.text();a=a.split(' src="/').join(' src="'+n),a=a.split(' href="/').join(' href="'+n),t.id=e+"-widget-container",t.attachShadow({mode:"open"}),t.shadowRoot.innerHTML=a,document.querySelector("html").append(t)}async function launchReactApp(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.querySelector("#"+e+"-widget-container"),i=t.shadowRoot.querySelectorAll("script");for(let e=0;e<i.length;e++)if(""==i[e].innerHTML||null==i[e].innerHTML||"false"==i[e].innerHTML){let n=i[e].getAttribute("src");i[e].remove();let c=document.createElement("script");c.src=n,t.shadowRoot.append(c)}}async function injectPopupUsingContentScript(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.createElement("div");t.id=e+"-widget",document.querySelector("html").append(t)}async function injectRawPopup(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.createElement("div"),i=await chrome.runtime.getURL("widget.html"),n=await chrome.runtime.getURL(""),c=await fetch(i),a=await c.text();a=a.split(' src="/').join(' src="'+n),a=a.split(' href="/').join(' href="'+n),t.id=e+"-widget-container",t.innerHTML=a;let r=t.querySelectorAll("script");document.querySelector("html").append(t);for(let t=0;t<r.length;t++){let i=r[t].getAttribute("src");r[t].remove();let n=document.createElement("script");n.src=i,document.querySelector("#"+e+"-widget-container").append(n)}}async function injectCss(){let e=document.createElement("style"),t=await chrome.runtime.getURL("static/css/main.css"),i=await fetch(t),n=await i.text();e.innerHTML=n,document.querySelector("html").append(e)}async function injectIframePopup(){let e=(await chrome.runtime.sendMessage({action:"getAppName"})).res,t=document.createElement("iframe");t.src=await chrome.runtime.getURL("widget.html"),t.id=e+"-widget",document.querySelector("html").append(t)}helpers.Injection=class Injection{async injectWidget(e){if(void 0!==e)try{await chrome.scripting.executeScript({target:{tabId:e.id},function:injectFonts}),await chrome.scripting.executeScript({target:{tabId:e.id},function:injectAppDivAndStyle}),await chrome.scripting.executeScript({target:{tabId:e.id},files:["static/js/main.js"]})}catch(e){trace(e,e.stack)}}async injectCloseWidget(e){await chrome.scripting.executeScript({target:{tabId:e.id},function:closeWidget})}async injectCommunicationSystem(e){if(void 0!==e)try{await chrome.scripting.executeScript({target:{tabId:e},files:["utils/injections/CommunicationSystem.js"]})}catch(e){trace(e,e.stack)}}async injectFromIcon(e){let t=await chrome.tabs.sendMessage(e.id,{action:"isWidgetInjected"});console.log("MAXIMIZE WIDGET1"),!0==!t.res?this.injectWidget(e):(console.log("MAXIMIZE WIDGET"),await chrome.scripting.executeScript({target:{tabId:e.id},function:maximizeWidget}));let i=await helpers.Utils.getRetailerFromUrl(e.url);await helpers.Utils.unhideWidgetByRetailerId(i.id)}};